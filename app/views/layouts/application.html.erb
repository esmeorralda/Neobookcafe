<!DOCTYPE html>
<html>

  <head>
    <%# <%= favicon_link_tag 'favicon.png'  %>
    <%= favicon_link_tag 'favicon.svg', rel: 'icon', type: 'image/svg+xml' %>
   <%= javascript_importmap_tags %> 



    <title>NeoBookCafe</title>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap" rel="stylesheet">
    <!-- êµ¬ê¸€ í°íŠ¸ í”„ë¦¬ì»¤ë„¥íŠ¸ & í°íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸° -->
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Gowun+Batang&display=swap" rel="stylesheet" />


    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_include_tag "application", "data-turbo-track": "reload", defer: true %>
    <%= javascript_importmap_tags %>
  </head>

  <body>
    <header class="site-header">
      <div class="header-container">
        <%# <div class="logo">
          <%= image_tag "logo.svg", alt: "NeoBookCafe Logo", class: "logo" %>
          <%# <span class="brand">BookCafe</span>
        </div> %> 
  <%= link_to root_path, class: "logo flex items-center space-x-2" do %>
  <%= image_tag "logo.svg", alt: "NeoBookCafe Logo", class: "logo" %>
  <span class="brand">BookCafe</span>
<% end %>

      <%= form_with url: search_path, method: :get, class: "search-box", data: { turbo: false } do |f| %>
  <%= f.text_field :q, 
      value: params[:q], 
      placeholder: "ì±… ì œëª©, ì €ì, ê¸€ ì œëª©, ê¸€ ì €ì...", 
      class: "search-input" %>
  <%= f.button "ğŸ”", 
      type: "submit", 
      class: "search-btn",
      name: nil %>
<% end %>


   <div class="nav-links">
  <% if user_signed_in? %>
    <button id="toggle-right-sidebar" class="text-[14px] text-[#333] no-underline">í”„ë¡œí•„</button>
<%= link_to "ì„¤ì •", "#", class: "open-settings-modal text-sm underline", data: { url: settings_path } %>


      <%= link_to "ë¡œê·¸ì•„ì›ƒ", destroy_user_session_path, method: :delete, data: { turbo_method: :delete }, class: "text-[14px] text-[#333] no-underline" %>
  <% else %>
    <%= link_to "ë¡œê·¸ì¸", new_user_session_path %>
  <% end %>
</div>



         <%# <button onclick="openModal()" class="bg-blue-600 px-4 py-2">
            ë¡œê·¸ì¸
          </button> %>
      </div>
   <div id="test-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center"
     style="top: 50%; left: 50%; transform: translate(-50%, -50%);">
  <div class="bg-white p-6 rounded shadow-lg max-w-6xl w-full max-h-[90vh] overflow-auto border border-gray-300">

    <h2 class="text-2xl font-bold mb-6">ì„¤ì •</h2>

    <!-- íƒ­ ë²„íŠ¼ -->
    <nav class="flex border-b border-gray-300 mb-6" id="modal-tabs">
      <button class="tab-btn px-4 py-2 border-b-2 border-[#3e2f23] font-semibold focus:outline-none" data-tab="0">ì•Œë¦¼</button>
      <button class="tab-btn px-4 py-2 border-b-2 border-transparent hover:border-gray-400 focus:outline-none ml-6" data-tab="1">ê¸€ì</button>
      <button class="tab-btn px-4 py-2 border-b-2 border-transparent hover:border-gray-400 focus:outline-none ml-6" data-tab="2">ì–¸ì–´</button>
      <button class="tab-btn px-4 py-2 border-b-2 border-transparent hover:border-gray-400 focus:outline-none ml-6" data-tab="3">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
    </nav>

    <!-- íƒ­ ë‚´ìš© -->
    <div id="tab-contents">
      <section class="tab-content">
        <h3 class="text-xl font-semibold mb-3">ì•Œë¦¼ ì„¤ì •</h3>
        <label class="inline-flex items-center mt-1">
          <input type="checkbox" class="form-checkbox" />
          <span class="ml-2">í‘¸ì‹œ ì•Œë¦¼ ë°›ê¸°</span>
        </label>

        <div class="flex justify-center gap-6 mt-6">
          <button class="bg-[#3e2f23] text-white py-2 px-6 rounded hover:bg-[#5b4633]">ì ìš©í•˜ê¸°</button>
          <button id="close-modal-btn" class="bg-gray-300 py-2 px-6 rounded hover:bg-gray-400">ë‹«ê¸°</button>
        </div>
      </section>

 <section class="tab-content hidden">
  <h3 class="text-xl font-semibold mb-3">ê¸€ì ì„¤ì •</h3>
  <label class="block mt-2">
    <span class="text-sm font-medium mb-1 block">ê¸€ì í¬ê¸° ì¡°ì ˆ</span>
    <input type="range" id="font-size-slider" min="13" max="19" value="16" class="w-full" />
  </label>

  <div class="flex justify-center gap-6 mt-6">
    <button id="close-modal-btn-2" class="bg-gray-300 py-2 px-6 rounded hover:bg-gray-400">ë‹«ê¸°</button>
  </div>
</section>

      <section class="tab-content hidden">
        <h3 class="text-xl font-semibold mb-3">ì–¸ì–´ ì„¤ì •</h3>
        <label for="language-select" class="block text-sm mb-1">ì–¸ì–´ ì„ íƒ</label>
        <select id="language-select" class="w-full border border-gray-300 rounded px-3 py-2">
          <option value="ko">í•œêµ­ì–´ (Korean)</option>
          <option value="en">English</option>
        </select>

        <div class="flex justify-center gap-6 mt-6">
          <button class="bg-[#3e2f23] text-white py-2 px-6 rounded hover:bg-[#5b4633]">ì ìš©í•˜ê¸°</button>
          <button id="close-modal-btn-3" class="bg-gray-300 py-2 px-6 rounded hover:bg-gray-400">ë‹«ê¸°</button>
        </div>
      </section>

      <section class="tab-content hidden">
        <h3 class="text-xl font-semibold mb-3">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</h3>
       <% if user_signed_in? %>
<% resource = current_user %>
<% resource_name = :user %>
<% devise_mapping = Devise.mappings[:user] %>
<% @minimum_password_length = Devise.password_length.min %>

<%= form_for(resource, as: resource_name, url: registration_path(resource_name), html: { method: :put }) do |f| %>
  <div class="mb-6">
    <%= f.label :current_password, "í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ (ë³€ê²½ ì‚¬í•­ í™•ì¸ìš©)", class: "block text-sm font-medium mb-1" %>
    <%= f.password_field :current_password, autocomplete: "current-password", class: "w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-[#3e2f23]" %>
  </div>

  <div class="mb-6">
    <%= f.label :password, "ìƒˆ ë¹„ë°€ë²ˆí˜¸ (ë³€ê²½í•˜ì§€ ì•Šìœ¼ë ¤ë©´ ë¹„ì›Œë‘ì„¸ìš”)", class: "block text-sm font-medium mb-1" %>
    <%= f.password_field :password, autocomplete: "new-password", class: "w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-[#3e2f23]" %>
    <% if @minimum_password_length %>
      <p class="text-xs mt-1 text-gray-500">ìµœì†Œ <%= @minimum_password_length %>ì ì´ìƒ</p>
    <% end %>
  </div>

  <div class="mb-6">
    <%= f.label :password_confirmation, "ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸", class: "block text-sm font-medium mb-1" %>
    <%= f.password_field :password_confirmation, autocomplete: "new-password", class: "w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-[#3e2f23]" %>
  </div>

  <div class="flex justify-center gap-6 mt-6">
    <%= f.submit "ì ìš©í•˜ê¸°", class: "bg-[#3e2f23] text-white py-2 px-6 rounded hover:bg-[#5b4633]" %>
    <button type="button" id="close-modal-btn-4" class="bg-gray-300 py-2 px-6 rounded hover:bg-gray-400">ë‹«ê¸°</button>
  </div>
<% end %>
<% end %>
      </section>
    </div>

  </div>
</div>
<% if @show_sidebar %>
  <div class="bg-[#f3ede3] pt-1 text-sm text-[#7c6243] flex justify-center space-x-8 relative">
    <% if params[:category] == "creation" %>
      <%= link_to "ì „ì²´", posts_path(category: :creation), class: "pb-1 border-b-2 border-transparent hover:border-[#7c6243]" %>
      <%= link_to "ì‹œ", posts_path(category: :creation, book_genre: :poetry), class: "pb-1 border-b-2 border-transparent hover:border-[#7c6243]" %>
      <%= link_to "ì—ì„¸ì´", posts_path(category: :creation, book_genre: :essay), class: "pb-1 border-b-2 border-transparent hover:border-[#7c6243]" %>
      <%= link_to "ì†Œì„¤", posts_path(category: :creation, book_genre: :novel), class: "pb-1 border-b-2 border-transparent hover:border-[#7c6243]" %>
    <% else %>
      <%= link_to "ì „ì²´", posts_path(category: params[:category]), class: "pb-1 border-b-2 border-transparent hover:border-[#7c6243]" %>
      <%= link_to "ì² í•™", posts_path(category: params[:category], book_genre: :philosophy), class: "pb-1 border-b-2 border-transparent hover:border-[#7c6243]" %>
      <%= link_to "ë¬¸í•™", posts_path(category: params[:category], book_genre: :literature), class: "pb-1 border-b-2 border-transparent hover:border-[#7c6243]" %>
      <%= link_to "ì—­ì‚¬", posts_path(category: params[:category], book_genre: :history), class: "pb-1 border-b-2 border-transparent hover:border-[#7c6243]" %>
      <%= link_to "ì‚¬íšŒ", posts_path(category: params[:category], book_genre: :society), class: "pb-1 border-b-2 border-transparent hover:border-[#7c6243]" %>
      <%= link_to "ê²½ì œ", posts_path(category: params[:category], book_genre: :economy), class: "pb-1 border-b-2 border-transparent hover:border-[#7c6243]" %>
      <%= link_to "ê³¼í•™/ê¸°ìˆ ", posts_path(category: params[:category], book_genre: :science_technology), class: "pb-1 border-b-2 border-transparent hover:border-[#7c6243]" %>
    <% end %>
  </div>
<% end %>


    </header>



    <%= render 'layouts/sidebar' %>

   <main class="main-content h-[calc(100vh-4rem)] overflow-auto mt-15">
  <%= yield %>
</main>



<div id="right-sidebar" class="hidden fixed top-16 right-0 h-[calc(100vh-4rem)] w-64 bg-[#f0ece3] text-[#7c6243] shadow-lg z-50">

     <%= render 'layouts/right_sidebar' %>


</div>





  </body>

</html>

<% if user_signed_in? %>
<script>
document.addEventListener("DOMContentLoaded", () => {



  const form = document.querySelector("form"); // ì‹¤ì œ form ì„ íƒì ë§ê²Œ ìˆ˜ì • í•„ìš”
  const currentPasswordInput = form.querySelector("[name='user[current_password]']");
  const newPasswordInput = form.querySelector("[name='user[password]']");
  const confirmPasswordInput = form.querySelector("[name='user[password_confirmation]']");
  const submitBtn = document.getElementById("password-submit");

  form.addEventListener("submit", (e) => {
    e.preventDefault();

    const currentPassword = currentPasswordInput.value.trim();
    const newPassword = newPasswordInput.value.trim();
    const confirmPassword = confirmPasswordInput.value.trim();

    if (!currentPassword) {
      alert("í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
      currentPasswordInput.focus();
      return;
    }

    if (newPassword || confirmPassword) {
      // ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í–ˆë‹¤ë©´ ê²€ì¦
      if (newPassword.length < 6) {  // ìµœì†Œê¸¸ì´ ì˜ˆì‹œ
        alert("ìƒˆ ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.");
        newPasswordInput.focus();
        return;
      }

      if (newPassword !== confirmPassword) {
        alert("ìƒˆ ë¹„ë°€ë²ˆí˜¸ì™€ í™•ì¸ìš© ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
        confirmPasswordInput.focus();
        return;
      }

      if (newPassword === currentPassword) {
        alert("ìƒˆ ë¹„ë°€ë²ˆí˜¸ëŠ” í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ì™€ ë‹¬ë¼ì•¼ í•©ë‹ˆë‹¤.");
        newPasswordInput.focus();
        return;
      }
    }

    // ì—¬ê¸°ì— ì„œë²„ì— ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ìš”ì²­ ë¡œì§ ìˆ˜í–‰ (AJAX ë“±)
    // ë˜ëŠ” í¼ submit ì§„í–‰
    form.submit();
  });

  // ë‹«ê¸° ë²„íŠ¼
  document.getElementById("close-modal-btn-4").addEventListener("click", () => {
    document.getElementById("test-modal").classList.add("hidden");
  });
});

document.addEventListener("DOMContentLoaded", () => {
  const modal = document.getElementById("test-modal");
  const openBtns = document.querySelectorAll(".open-settings-modal");
  const closeBtns = modal.querySelectorAll("button[id^='close-modal-btn']");
  const tabs = modal.querySelectorAll(".tab-btn");
  const tabContents = modal.querySelectorAll(".tab-content");

  // ëª¨ë‹¬ ì—´ê¸°
  openBtns.forEach(btn => {
    btn.addEventListener("click", e => {
      e.preventDefault();
      modal.classList.remove("hidden");
      showTab(0); // ì²« íƒ­ ê¸°ë³¸ í‘œì‹œ
    });
  });

  // ëª¨ë‹¬ ë‹«ê¸°
  closeBtns.forEach(btn => {
    btn.addEventListener("click", () => {
      modal.classList.add("hidden");
    });
  });

  // íƒ­ í´ë¦­ ì´ë²¤íŠ¸
  tabs.forEach((tab, i) => {
    tab.addEventListener("click", () => {
      showTab(i);
    });
  });

  // íƒ­ í‘œì‹œ í•¨ìˆ˜
  function showTab(index) {
    tabs.forEach((tab, i) => {
      if(i === index){
        tab.classList.remove("border-transparent");
        tab.classList.add("border-[#3e2f23]", "font-semibold");
      } else {
        tab.classList.add("border-transparent");
        tab.classList.remove("border-[#3e2f23]", "font-semibold");
      }
    });

    tabContents.forEach((content, i) => {
      content.classList.toggle("hidden", i !== index);
    });
  }
});

document.addEventListener("DOMContentLoaded", () => {
  const slider = document.getElementById("font-size-slider");
  const applyBtn = document.getElementById("apply-font-size");

  // ì ìš© ë²„íŠ¼ í´ë¦­ ì‹œ, <html> í°íŠ¸ í¬ê¸° ë³€ê²½
  applyBtn.addEventListener("click", () => {
    const fontSize = slider.value + "px";
    document.documentElement.style.fontSize = fontSize;
  });

  slider.addEventListener("input", () => {
    const fontSize = slider.value + "px";
    document.documentElement.style.fontSize = fontSize;  // ì‹¤ì‹œê°„ ì ìš©
  });

});
document.addEventListener("DOMContentLoaded", () => {
  const slider = document.getElementById("font-size-slider");

  // ì €ì¥ëœ ê°’ì´ ìˆìœ¼ë©´ ì ìš©
  const savedFontSize = localStorage.getItem("fontSize");
  if (savedFontSize) {
    document.documentElement.style.fontSize = savedFontSize;
    slider.value = parseInt(savedFontSize);
  }

  // ìŠ¬ë¼ì´ë” ì´ë™í•  ë•Œë§ˆë‹¤ ì‹¤ì‹œê°„ ì ìš© + ì €ì¥
  slider.addEventListener("input", () => {
    const fontSize = slider.value + "px";
    document.documentElement.style.fontSize = fontSize;
    localStorage.setItem("fontSize", fontSize);
  });
});

</script>

<% if notice.present? %>
  <script>
    alert("<%= j(notice) %>");
  </script>
<% end %>

<% if alert.present? %>
  <script>
    alert("<%= j(alert) %>");
  </script>
<% end %>

<% end %>
