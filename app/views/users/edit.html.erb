<%= form_with(model: current_user, url: user_path(current_user), method: :patch, local: true) do |f| %>
  <div class="max-w-4xl mx-auto mt-10 px-4">
    <h1 class="text-3xl font-bold mb-6 text-[#3e2f23]">
      <%= current_user.name || "닉네임" %>님의 소개 편집
    </h1>

    <!-- 자기소개 -->
    <section class="mb-10 p-6 bg-[#f8f3ee] border border-[#a68c72] rounded-md relative">
      <div class="text-5xl absolute -top-6 left-4 text-[#a68c72]">“</div>
      <%= f.text_area :self_intro, class: "w-full bg-transparent border-0 text-[#3e2f23] text-lg placeholder-[#bbb] resize-none", rows: 2, placeholder: "한 줄 자기소개를 입력해주세요." %>
      <div class="text-5xl absolute -bottom-6 right-4 text-[#a68c72]">”</div>
    </section>

    <div class="mb-10 text-right">
      <%= f.submit "자기소개 저장", name: "commit_self_intro", class: "bg-[#3e2f23] text-white py-2 px-6 rounded hover:bg-[#2c241b]" %>
    </div>

    <!-- 책 소개 입력칸 -->
    <section>
      <h2 class="text-xl font-semibold mb-4 text-[#3e2f23]">책 소개 (최대 3개)</h2>
      <div id="book-intros" class="space-y-6">
        <% existing_intros = current_user.book_intros.limit(3).to_a %>
        <% 3.times do |i| %>
          <% intro = existing_intros[i] || BookIntro.new %>
          <div class="p-6 bg-[#f8f3ee] border border-[#a68c72] rounded-md relative">
            <div class="text-5xl absolute -top-6 left-4 text-[#a68c72]">“</div>
            <%= hidden_field_tag "book_intros[#{i}][id]", intro.id if intro.persisted? %>

            <%= text_area_tag "book_intros[#{i}][quote]", intro.quote, class: "w-full bg-transparent border-0 text-[#3e2f23] text-lg placeholder-[#bbb] resize-none mb-4", rows: 2, placeholder: "인상 깊은 한 구절을 입력해주세요." %>
            <div class="text-5xl absolute -bottom-6 right-4 text-[#a68c72]">”</div>

            <div class="flex flex-wrap items-center gap-4 mt-4">
              <label class="text-[#3e2f23] font-semibold">책</label>
              <%= text_field_tag "book_intros[#{i}][book_title]", intro.book_title, class: "flex-1 border border-[#a68c72] rounded p-2 text-[#3e2f23] placeholder-[#bbb]", placeholder: "책 제목" %>

              <label class="text-[#3e2f23] font-semibold">저자</label>
              <%= text_field_tag "book_intros[#{i}][author_name]", intro.author_name, class: "flex-1 border border-[#a68c72] rounded p-2 text-[#3e2f23] placeholder-[#bbb]", placeholder: "저자이름" %>
            </div>
          </div>
        <% end %>
      </div>
    </section>

    <div class="mt-10 text-right">
      <%= submit_tag "책 소개 저장", name: "commit_book_intros", class: "bg-[#3e2f23] text-white py-2 px-6 rounded hover:bg-[#2c241b]" %>
    </div>
  </div>
<% end %>
