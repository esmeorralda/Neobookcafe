<div class="relative max-w-3xl mx-auto space-y-4">
  <h1 class="text-3xl font-bold text-gray-800 mb-10">ğŸ“š ë…ì„œ ê¸°ë¡ì¥</h1>

  <% @books.each do |book| %>
    <% recent_notes = book.notes.order(position: :desc).limit(3) %>
    
    <div>
      <!-- ì±… ì œëª© + ì „ì²´ ìª½ìˆ˜ + ì§„í–‰ë¥  -->
      <div class="flex justify-between items-center mb-4">
        <div class="text-xl font-semibold text-gray-800">
          <%= book.title %>
          <% total_pages = book.total_pages || 0 %>
          <% read_pages = book.notes.sum { |n| (n.page_to || 0) - (n.page_from || 0) + 1 } %>
          <span class="ml-4 text-sm text-gray-500">
            <%= read_pages %>ìª½ Â· <%= total_pages > 0 ? number_to_percentage((read_pages.to_f / total_pages) * 100, precision: 0) : "0%" %>
          </span>
        </div>
        <%= link_to "í¸ì§‘", edit_book_path(book), class: "border border-gray-400 text-gray-800 px-3 py-1 rounded hover:bg-gray-100 text-sm" %>
      </div>

      <!-- ë…¸íŠ¸ ì¹´ë“œ -->
      <div class="flex flex-wrap gap-4">
        <% recent_notes.each do |note| %>
          <div class="relative w-56 p-4 pb-6 rounded-xl shadow-md" style="background-color: <%= note.color || '#fcfcf0' %>">
            <!-- í˜ì´ì§€ì™€ ë‚ ì§œ -->
            <div class="flex justify-between text-xs text-gray-700 mb-2">
              <span><%= note.page_from %>~<%= note.page_to %>ìª½</span>
              <span><%= note.created_at.strftime('%d/%m/%Y') %></span>
            </div>

            <!-- ë©”ëª¨ ë‚´ìš© -->
            <div class="whitespace-pre-wrap text-black text-sm leading-relaxed">
              <%= truncate(note.memo, length: 140) %>
            </div>

            <!-- í˜ì´ì§€ ì ‘íŒ íš¨ê³¼ -->
            <div class="absolute bottom-0 right-0 w-10 h-10 bg-[#e5e5d7] clip-path-corner"></div>

            <!-- ë”ë³´ê¸° ë²„íŠ¼ -->
            <%= link_to "ë”ë³´ê¸° Â»", note_path(note), class: "absolute bottom-2 right-4 text-xs text-gray-600 hover:underline" %>
          </div>
        <% end %>
      </div>

      <hr class="my-10 border-t border-gray-300">
    </div>
  <% end %>
</div>

<style>
  .clip-path-corner {
    clip-path: polygon(100% 0, 100% 100%, 0 100%);
  }
</style>
