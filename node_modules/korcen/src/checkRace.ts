const SINGLE_CHAR_NORMALIZATION_MAP: Record<string, string> = {
    'ğ—Œ': 's', 'ğ˜´': 's', 'ğ™¨': 's', 'ğšœ': 's', 'ğ¬': 's', 'ğ‘ ': 's', 'ğ’”': 's', 'ğ“ˆ': 's', 'ğ”°': 's', 'ğ–˜': 's', 'ğ•¤': 's',
    'ï½“': 's', 'ÅŸ': 's', 'â“¢': 's', 'â’®': 's', 'ğŸ…¢': 's', 'ğŸ†‚': 's', 'ğŸ…‚': 's', 'ğ‘º': 's', 'Å¿': 's', '$': 's', '5': 's', // Å¿:s ìœ ì§€, Å¡, Å›, Å, á¹£, á¹¡, È™, á¹¥, á¹§, á¹©ëŠ” s ì„¹ì…˜ì—ë§Œ ìˆì—ˆìŒ

    'ğ–¾': 'e', 'ğ˜¦': 'e', 'ğ™š': 'e', 'ğš': 'e', 'ğ': 'e', 'ğ‘’': 'e', 'ğ’†': 'e', 'â„¯': 'e', 'ğ“®': 'e', 'ğ”¢': 'e', 'ğ–Š': 'e', 'ğ•–': 'e',
    'ï½…': 'e', 'Ä—': 'e', 'â“”': 'e', 'â’ ': 'e', 'ğŸ…”': 'e', 'ğŸ…´': 'e', 'ğŸ„´': 'e', 'Ñ”': 'e', 'Ãª': 'e', 'Ã«': 'e', 'Ã©': 'e', 'Ã¨': 'e',
    'Ä“': 'e', 'Ä•': 'e', 'Ä›': 'e', 'Ä™': 'e', 'áº¹': 'e', 'áº»': 'e', 'áº½': 'e', 'áº¿': 'e', 'á»': 'e', 'á»‡': 'e', 'á»…': 'e', 'á»ƒ': 'e',
    '3': 'e', 'â‚¬': 'e',

    'ğ—‘': 'x', 'ğ˜¹': 'x', 'ğ™­': 'x', 'ğš¡': 'x', 'ğ±': 'x', 'ğ‘¥': 'x', 'ğ’™': 'x', 'ğ“': 'x', 'ğ”': 'x', 'ğ”µ': 'x', 'ğ–': 'x', 'ğ•©': 'x',
    'ï½˜': 'x', 'â“§': 'x', 'â’³': 'x', 'ğŸ…§': 'x', 'ğŸ†‡': 'x', 'ğŸ…‡': 'x', 'Ã—': 'x', 'âœ•': 'x', 'âœ–': 'x', 'âŒ': 'x', 'â¨¯': 'x',
    'âš”': 'x', '*': 'x', 'âœ—': 'x', 'âœ˜': 'x',

    'Å³': 'u', 'Ã¼': 'u', 'Ãº': 'u', 'Ã¹': 'u', 'Ã»': 'u', 'Å©': 'u', 'Å«': 'u', 'Å­': 'u', 'Å¯': 'u', 'Å±': 'u', 'á»¥': 'u', 'Æ°': 'u',
    'Ã§': 'c', 'Ä‡': 'c', 'Ä‰': 'c', 'Ä': 'c', 'Ä‹': 'c', 'Â¢': 'c', 'Â©': 'c', 'á¸‰': 'c', '(': 'c', '<': 'c',
    'ï¼¦': 'F', 'á¸': 'F', 'Æ‘': 'F', 'â„±': 'F', 'ê˜': 'F', 'ê»': 'F',
    'ï¼«': 'K', 'á¸°': 'K', 'Ç¨': 'K', 'á¸²': 'K', 'á¸´': 'K', 'â±©': 'K', 'ê€': 'K',
    'ï¼£': 'C', 'Ä†': 'C', 'Äˆ': 'C', 'ÄŒ': 'C', 'ÄŠ': 'C', 'Ã‡': 'C', 'á¸ˆ': 'C',
    'ï¼µ': 'U', 'Ãš': 'U', 'Ã™': 'U', 'Ã›': 'U', 'Å¨': 'U', 'Åª': 'U', 'Å¬': 'U', 'Å®': 'U', 'Å°': 'U', 'á»¤': 'U',

    'ã…—': 'ã…—', 'â”»': 'ã…—', 'â”´': 'ã…—', 'â”¹': 'ã…—', 'âŠ¥': 'ã…—', 'â€ ': 'ã…—', 'âŸ‚': 'ã…—', 'â•¨': 'ã…—', 'â•§': 'ã…—', 'â•¥': 'ã…—',
    '^': 'ã……', 'äºº': 'ã……', 'âˆ§': 'ã……', 'ã‰¦': 'ã……', 'á²': 'ã……', 'Î›': 'ã……', 'â©˜': 'ã……', 'â‹€': 'ã……', 'â©š': 'ã……',
    'ç”˜': 'ã…‚', 'å»¿': 'ã…‚', 'á—¨': 'ã…‚', 'á—': 'ã…‚', 'á—•': 'ã…‚', 'ç”°': 'ã…‚', 'å£': 'ã…‚', 'æ—¥': 'ã…‚', 'ç›®': 'ã…‚', 'å›—': 'ã…‚',
    'å·±': 'ã„¹', 'ä¹™': 'ã„¹', 'å·²': 'ã„¹', 'å·³': 'ã„¹', 'åŒš': 'ã„·',
    'åœ': 'ã…', '/': 'ã…', 'â¼ƒ': 'ã…', 'â¼': 'ã…', 'â¼‚': 'ã…', 'r': 'ã…', 'F': 'ã…',
    'ã…£': 'ã…£', 'Â¦': 'ã…£', 'ï½œ': 'ã…£', 'ï¿¤': 'ã…£', 'Ğ†': 'ã…£', 'Ó€': 'ã…£', '1': 'ã…£', '|': 'ã…£', 'l': 'ã…£', '!': 'ã…£', 'I': 'ã…£', // 1, |, l, !, I ëª¨ë‘ ã…£ë¡œ ë§¤í•‘
    'H': 'ã…', 'ã…–': 'ã…', 'ã…’': 'ã…', 'Ğ': 'ã…', 'â²': 'ã…', 'â„': 'ã…',
    'ğŸ¦': 'ìƒˆ', 'ğŸ”': 'ìƒˆ', 'ğŸ¦…': 'ìƒˆ', 'ğŸ¦‰': 'ìƒˆ', 'ğŸ¦†': 'ìƒˆ', 'ğŸ¦œ': 'ìƒˆ', 'ğŸ¦¤': 'ìƒˆ', 'ğŸ¦¢': 'ìƒˆ', 'ğŸ•Š': 'ìƒˆ',
    'ğŸ•': 'ê°œ', 'ğŸ¶': 'ê°œ', 'ğŸº': 'ê°œ',
    'ä¸•': 'ì¡°', 'æœ': 'ì¡°', 'å‰‡': 'ì¡°', 'å…†': 'ì¡°', 'çµ„': 'ì¡°', 'æ—©': 'ì¡°', 'é³¥': 'ì¡°', 'æ½®': 'ì¡°', 'ç…§': 'ì¡°',
    '0': 'ã…‡', 'O': 'ã…‡', 'o': 'ã…‡', 'â—¯': 'ã…‡', 'â­•': 'ã…‡', 'â—‹': 'ã…‡', 'â—': 'ã…‡', 'â—': 'ã…‡', 'â—‰': 'ã…‡', 'â—Œ': 'ã…‡', // o:ã…‡ ìœ ì§€

    'a': 'a', '@': 'a', '4': 'a', 'Î±': 'a', 'Ã¤': 'a', 'Ã¥': 'a', 'Ã£': 'a', 'Ä': 'a', 'È§': 'a', 'Ç': 'a',
    'b': 'b', '8': 'b', '6': 'b', 'Æƒ': 'b', 'É“': 'b', 'Æ„': 'b', 'â„¬': 'b', 'á–¯': 'b', 'á‘²': 'b',
    'd': 'd', 'á¸‹': 'd', 'á¸': 'd', 'á‘¯': 'd', 'á—': 'd', 'á—ª': 'd', 'á–™': 'd', 'â…†': 'd', 'É—': 'd',
    'f': 'f', 'Æ’': 'f', 'á¸Ÿ': 'f', 'â…': 'f', 'á¶‚': 'f', 'êœ°': 'f', 'êŸ»': 'f',
    'g': 'g', 'Ç¥': 'g', 'É¡': 'g', 'Ä¡': 'g', 'Ä£': 'g', 'Ä': 'g', 'Ç§': 'g', '9': 'g', 
    'h': 'h', 'Ä¥': 'h', 'Ä§': 'h', 'Æ•': 'h', 'á¸¥': 'h', 'á¸«': 'á¸«', 'â±¨': 'h', 'êœ§': 'h',
    'i': 'i', 'Ä«': 'i', 'Ä­': 'i', 'Ç': 'i', 'Ä¯': 'i',
    'j': 'j', 'Äµ': 'j', 'Ç°': 'j', 'È·': 'j', 'É‰': 'j', 'â±¼': 'j', 'Ê': 'j', 'ÉŸ': 'j',
    'k': 'k', 'Ä·': 'k', 'Æ™': 'k', 'Ç©': 'k', 'á¸±': 'k', 'á¸³': 'k', 'á¸µ': 'k', 'â±ª': 'k',
    'Äº': 'l', 'Ä¼': 'l', 'Ä¾': 'l', 'Å€': 'l', 'Å‚': 'l',
    'm': 'm', 'É±': 'm', 'á¸¿': 'm', 'á¹': 'm', 'á¹ƒ': 'm', 'â±¥': 'm', 'áµ¯': 'm', 'á´': 'm',
    'n': 'n', 'Å„': 'n', 'Åˆ': 'n', 'Ã±': 'n', 'Å†': 'n', 'á¹…': 'n', 'á¹‡': 'n', 'á¹‰': 'n',
    'p': 'p', 'á¹•': 'p', 'á¹—': 'p', 'Æ¥': 'p', 'áµ½': 'p', 'áµ±': 'p', 'á´˜': 'p', 'á‘­': 'p',
    'q': 'q', 'Ê ': 'q', 'É‹': 'q', 'È¹': 'q', 'â±Š': 'q', 'â±': 'q', 'ê—': 'q',
    'Å•': 'r', 'Å™': 'r', 'Å—': 'r', 'á¹™': 'r', 'á¹›': 'r', 'á¹': 'r', 'á¹Ÿ': 'r', 
    't': 't', '7': 't', '+': 't', 'Å¥': 't', 'Å£': 't', 'Å§': 't', 'È›': 't', 'á¹«': 't',
    'v': 'v', 'á¹¿': 'v', 'â±´': 'v', 'áµ¥': 'v', 'áµ›': 'v', 'âˆš': 'v', 'á±': 'v', 'âˆ¨': 'v',
    'w': 'w', 'áº': 'w', 'áºƒ': 'w', 'áº…': 'w', 'Åµ': 'w', 'áº‡': 'w', 'áº‰': 'w', 'â±³': 'w',
    'y': 'y', 'Ã½': 'y', 'á»³': 'y', 'Å·': 'y', 'Ã¿': 'y', 'È³': 'y', 'áº': 'y', 'á»µ': 'y',
    'z': 'z', '2': 'z', 'Åº': 'z', 'áº‘': 'z', 'Å¾': 'z', 'Å¼': 'z', 'áº“': 'z', 'áº•': 'z',
};

const MULTI_CHAR_REPLACEMENTS: Record<string, string> = {
    '_ã…£_': 'ã…—', '_/_': 'ã…—', '_ |\_': 'ã…—', '_|\_': 'ã…—', '_ã…£\\_': 'ã…—', '_I_': 'ã…—',
    'ï¼ï¼¼': 'ã……', '/ï¼¼': 'ã……',
    '77': 'ã„²',
    'åˆ€åœ': 'ê¹Œ',
    'â‚¨': 'rs',
    'ã…‡l=ìŠ¤': 'ì„¹ìŠ¤',
    'ã…‡ã…£-ã…£': 'ì• ',
    'lã…£': 'ë‹ˆ',
    'ã…ã…£': 'ë¯¸',
    'ä¸•åˆ€åœå·±åœäººä¸¨å»¿åœå·±åœå£åœ': 'ì¡°ê¹Œì”¹ìŒ”ë¼',
};

const FALSE_POSITIVE_PATTERNS_RACE: string[] = ['í‘í˜•ë‹˜'];

const allFalsePositivePatterns: string[] = [
    ...FALSE_POSITIVE_PATTERNS_RACE,
];
allFalsePositivePatterns.sort((a, b) => b.length - a.length);

const ALL_FP_REGEX: RegExp = new RegExp(allFalsePositivePatterns.map(escapeRegex).join('|'), 'gi');

const RACE_PROFANITY_PATTERNS: string[] = [
    'ê¹œë‘¥ì´', 'í‘í˜•', 'ì¡°ì„¼ì§„', 'ì§±ê°œ', 'ì§±ê¹¨', 'ì§±ê»˜', 'ì§±ê²Œ', 'ìª½ë°”ë¦¬', 'ìª½íŒŒë¦¬', 'ë¹¨ê°±ì´', 'ë‹ˆê·¸ë¡œ', 'ì½”ìŸì´', 'ì¹­ì´', 'ì¹­ì±™ì´', 'ì„¬ìˆ­ì´', 'ì™œë†ˆ', 'ì§±ê¼´ë¼', 'ì„¬ì§±ê¹¨',
];


const allProfanityPatterns: string[] = [
    ...RACE_PROFANITY_PATTERNS,
];

allProfanityPatterns.sort((a, b) => b.length - a.length);

function escapeRegex(string: string): string {
    return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
}

const singleCharMapRegex: RegExp = new RegExp(Object.keys(SINGLE_CHAR_NORMALIZATION_MAP).map(key => escapeRegex(key)).join('|'), 'gi');

const multiCharReplacementRegex: RegExp = new RegExp(
    Object.keys(MULTI_CHAR_REPLACEMENTS)
        .map(escapeRegex)
        .sort((a, b) => b.length - a.length)
        .join('|'),
    'gi'
);

export function race(text: string | any): boolean {
    if (typeof text !== 'string') {
        if (text === null || text === undefined) {
             throw new Error('korcen: í™•ì¸í•  í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”');
        }
        throw new Error('korcen: String íƒ€ì…ë§Œ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤');
    }
    if (!text.trim()) {
        throw new Error('korcen: í™•ì¸í•  í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”');
    }

    let processedText: string = text.toLowerCase().replace(/ /gi, '');

    processedText = processedText.replace(singleCharMapRegex, (match: string): string => {
        const lowerMatch = match.toLowerCase();
        for (const key in SINGLE_CHAR_NORMALIZATION_MAP) {
            if (key.toLowerCase() === lowerMatch) {
                return SINGLE_CHAR_NORMALIZATION_MAP[key];
            }
        }
        return match;
    });

    processedText = processedText.replace(multiCharReplacementRegex, (match: string): string => {
        const lowerMatch = match.toLowerCase();
        for (const key in MULTI_CHAR_REPLACEMENTS) {
            if (key.toLowerCase() === lowerMatch) {
                return MULTI_CHAR_REPLACEMENTS[key];
            }
        }
        return match;
    });

    processedText = processedText.replace(ALL_FP_REGEX, '');

    for (const pattern of allProfanityPatterns) {
        if (processedText.includes(pattern.toLowerCase())) {
            return true;
        }
    }

    return false;
}
